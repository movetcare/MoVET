
  <!DOCTYPE html>
  <html>
    <head>
      <title>RequestAnAppointmentControls.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx</td><td class="">90.05%</td><td class="">75%</td><td class="">211</td><td class="">190</td><td class="">21</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  faArrowRightToBracket,
  faCircleCheck,
  faCircleExclamation,
  faWrench,
} from &quot;@fortawesome/free-solid-svg-icons&quot;;
import { FontAwesomeIcon } from &quot;@fortawesome/react-fontawesome&quot;;
import { doc, serverTimestamp, setDoc } from &quot;firebase/firestore&quot;;
import Error from &quot;components/Error&quot;;
import { useEffect, useState } from &quot;react&quot;;
import { auth, firestore } from &quot;services/firebase&quot;;
import { Loader } from &quot;ui&quot;;
import { Switch } from &quot;@headlessui/react&quot;;
import { Controller, useForm } from &quot;react-hook-form&quot;;
import { classNames } from &quot;utils/classNames&quot;;
import toast from &quot;react-hot-toast&quot;;
import { onAuthStateChanged } from &quot;firebase/auth&quot;;
import { useDocument } from &quot;react-firebase-hooks/firestore&quot;;

export const RequestAnAppointmentControls = () =&gt; {
  const [isAdmin, setIsAdmin] = useState&lt;boolean&gt;(false);
  const [settings, loading, error] = useDocument(
    doc(firestore, &quot;configuration/bookings&quot;)
  );
  const {
    handleSubmit,
    control,
    watch,
    reset,
    formState: { isDirty, isSubmitting },
  } = useForm({
    mode: &quot;onSubmit&quot;,
    defaultValues: {
      requirePaymentMethodToRequestAnAppointment: false,
    },
  });
  const requirePaymentMethodToRequestAnAppointment = watch(
    &quot;requirePaymentMethodToRequestAnAppointment&quot;
  );
  useEffect(() =&gt; {
    const unsubscribe = onAuthStateChanged(auth, (user) =&gt; {
      if (user) {
        const claimsString = (user as any)?.reloadUserInfo?.customAttributes;
        if (claimsString) {
          const claims = JSON.parse(claimsString);
          if (claims?.isSuperAdmin || claims?.isAdmin) setIsAdmin(true);
        }
      }
    });
    return () =&gt; unsubscribe();
  }, []);

  useEffect(() =&gt; {
    console.log(
      &quot;settings.data()&quot;,
      settings?.data()?.requirePaymentMethodToRequestAnAppointment
    );
    if (settings &amp;&amp; settings.data())
      reset({
        requirePaymentMethodToRequestAnAppointment:
          settings.data()?.requirePaymentMethodToRequestAnAppointment,
      });
  }, [settings, reset]);

  const onSubmit = async (data: any) =&gt;
    await setDoc(
      doc(firestore, &quot;configuration/bookings&quot;),
      {
        requirePaymentMethodToRequestAnAppointment:
          data.requirePaymentMethodToRequestAnAppointment,
        updatedOn: serverTimestamp(),
      },
      { merge: true }
    )
      .then(() =&gt;
        toast(`Update Successful!`, {
          duration: 5000,
          position: &quot;bottom-center&quot;,
          icon: (
            &lt;FontAwesomeIcon
              icon={faCircleCheck}
              size=&quot;sm&quot;
              className=&quot;text-movet-green&quot;
            /&gt;
          ),
        })
      )
      .catch((error: any) =&gt;
        toast(`Payment Method Required Update FAILED: ${error?.message}`, {
          duration: 5000,
          position: &quot;bottom-center&quot;,
          icon: (
            &lt;FontAwesomeIcon
              icon={faCircleExclamation}
              size=&quot;sm&quot;
              className=&quot;text-movet-red&quot;
            /&gt;
          ),
        })
      );

  return isAdmin ? (
    &lt;div className=&quot;bg-white shadow overflow-hidden rounded-lg mb-4&quot;&gt;
      &lt;div className=&quot;flex flex-row items-center justify-center -mb-4&quot;&gt;
        &lt;FontAwesomeIcon
          icon={faArrowRightToBracket}
          className={&quot;text-movet-red&quot;}
          size=&quot;lg&quot;
        /&gt;
        &lt;h1 className=&quot;ml-2 my-4 text-lg cursor-pointer&quot;&gt;
          {loading ? &quot;Loading...&quot; : &quot;Request an Appointment Settings&quot;}
        &lt;/h1&gt;
      &lt;/div&gt;
      {loading ? (
        &lt;div className=&quot;mb-6&quot;&gt;
          &lt;Loader height={200} width={200} /&gt;
        &lt;/div&gt;
      ) : error ? (
        &lt;div className=&quot;px-8 pb-8&quot;&gt;
          &lt;Error error={error} /&gt;
        &lt;/div&gt;
      ) : (
        &lt;ul
          role=&quot;list&quot;
          className=&quot;divide-y divide-movet-gray border-t border-movet-gray my-4&quot;
        &gt;
          &lt;li&gt;
            &lt;div
              className={
                &quot;flex flex-col items-center px-4 py-4 sm:px-6 group mx-auto max-w-xl&quot;
              }
            &gt;
              &lt;div className=&quot;min-w-0 flex-col w-full justify-center&quot;&gt;
                &lt;form
                  onSubmit={handleSubmit(onSubmit as any)}
                  className=&quot;text-center text-sm cursor-pointer -mb-2&quot;
                &gt;
                  &lt;div className=&quot;flex flex-col sm:flex-row justify-between items-center w-full mx-auto py-2&quot;&gt;
                    &lt;span className=&quot;font-extrabold mb-4&quot;&gt;
                      Require a Valid Payment Method:
                    &lt;/span&gt;
                    &lt;Controller
                      name=&quot;requirePaymentMethodToRequestAnAppointment&quot;
                      control={control}
                      render={({ field: { onChange, onBlur, value } }: any) =&gt; (
                        &lt;Switch
                          checked={value}
                          onChange={onChange}
                          onBlur={onBlur}
                          className={classNames(
                            requirePaymentMethodToRequestAnAppointment
                              ? &quot;bg-movet-green&quot;
                              : &quot;bg-movet-red&quot;,
                            &quot;relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200&quot;
                          )}
                        &gt;
                          &lt;span
                            aria-hidden=&quot;true&quot;
                            className={classNames(
                              requirePaymentMethodToRequestAnAppointment
                                ? &quot;translate-x-5&quot;
                                : &quot;translate-x-0&quot;,
                              &quot;inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200&quot;
                            )}
                          /&gt;
                        &lt;/Switch&gt;
                      )}
                    /&gt;
                  &lt;/div&gt;
                  &lt;button
                    type=&quot;submit&quot;
                    disabled={!isDirty || isSubmitting}
                    className={classNames(
                      !isDirty || isSubmitting
                        ? &quot;w-full items-center justify-center rounded-full h-10 text-movet-gray focus:outline-none mr-4&quot;
                        : &quot;w-full cursor-pointer items-center justify-center rounded-full h-10 transition duration-500 ease-in-out text-movet-black hover:bg-movet-gray hover:bg-opacity-25 focus:outline-none mr-4&quot;,
                      &quot;mt-6&quot;
                    )}
                  &gt;
                    &lt;FontAwesomeIcon icon={faWrench} size=&quot;lg&quot; /&gt;
                    &lt;span className=&quot;ml-2&quot;&gt;Save&lt;/span&gt;
                  &lt;/button&gt;
                &lt;/form&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      )}
    &lt;/div&gt;
  ) : (
    &lt;&gt;&lt;/&gt;
  );
};
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:14,&quot;text&quot;:&quot;claimsString&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:44,&quot;text&quot;:&quot;reloadUserInfo&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:60,&quot;text&quot;:&quot;customAttributes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:43,&quot;character&quot;:12,&quot;text&quot;:&quot;claimsString&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:44,&quot;character&quot;:16,&quot;text&quot;:&quot;claims&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:14,&quot;text&quot;:&quot;claims&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:22,&quot;text&quot;:&quot;isSuperAdmin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:38,&quot;text&quot;:&quot;claims&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:46,&quot;text&quot;:&quot;isAdmin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:55,&quot;character&quot;:24,&quot;text&quot;:&quot;requirePaymentMethodToRequestAnAppointment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:60,&quot;character&quot;:27,&quot;text&quot;:&quot;requirePaymentMethodToRequestAnAppointment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:64,&quot;character&quot;:26,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:68,&quot;character&quot;:8,&quot;text&quot;:&quot;requirePaymentMethodToRequestAnAppointment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:69,&quot;character&quot;:10,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:69,&quot;character&quot;:15,&quot;text&quot;:&quot;requirePaymentMethodToRequestAnAppointment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:87,&quot;character&quot;:14,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:88,&quot;character&quot;:56,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:88,&quot;character&quot;:63,&quot;text&quot;:&quot;message&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:144,&quot;character&quot;:42,&quot;text&quot;:&quot;onChange&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:144,&quot;character&quot;:52,&quot;text&quot;:&quot;onBlur&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/admin.movetcare.com/components/settings/RequestAnAppointmentControls.tsx&quot;,&quot;line&quot;:144,&quot;character&quot;:60,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 02 Mar 2023 15:37:59 GMT</p>
    </body>
  </html>
  