
  <!DOCTYPE html>
  <html>
    <head>
      <title>initConfig.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">apps/api.movetcare.com/src/config/initConfig.ts</td><td class="">87.06%</td><td class="">75%</td><td class="">201</td><td class="">175</td><td class="">26</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { configureReasonGroups } from &quot;./../integrations/provet/entities/reason/configureReasonGroups&quot;;
import { configureTerminals } from &quot;./configureTerminals&quot;;
import { Request, Response } from &quot;express&quot;;
import { mobileClientApiKey, environment, admin, throwError } from &quot;./config&quot;;
import { configureAppointments } from &quot;../integrations/provet/entities/appointment/configure/configureAppointments&quot;;
import { configureBreeds } from &quot;../integrations/provet/entities/patient/breeds/configureBreeds&quot;;
import { configureReasons } from &quot;../integrations/provet/entities/reason/configureReasons&quot;;
import { configureShifts } from &quot;../integrations/provet/entities/shift/configureShifts&quot;;
import { configureAppointmentEstimates } from &quot;../integrations/provet/entities/appointment/configure/configureAppointmentEstimates&quot;;
import { configureAppointmentOptionDetails } from &quot;../integrations/provet/entities/appointment/configure/configureAppointmentOptionDetails&quot;;
import { configureCancellationReasons } from &quot;../integrations/provet/entities/reason/configureCancellationReasons&quot;;
import { configureTelehealthStatus } from &quot;../integrations/provet/entities/appointment/configure/configureTelehealthStatus&quot;;
import { configureInvoices } from &quot;../integrations/provet/entities/invoice/configureInvoices&quot;;
import { configureUsers } from &quot;./configureUsers&quot;;
import { configureItems } from &quot;../integrations/provet/entities/item/configureItems&quot;;
import { configureBooking } from &quot;../booking/configureBooking&quot;;
import { sendNotification } from &quot;../notifications/sendNotification&quot;;

export const initProVetConfig = async (
  { body: { apiKey, type } }: Request&lt;{ body: any }&gt;,
  response: Response
): Promise&lt;Response&gt; =&gt; {
  if (apiKey === mobileClientApiKey) {
    if (environment.type === &quot;production&quot;)
      sendNotification({
        type: &quot;slack&quot;,
        payload: {
          message: `:warning: Platform Configuration &quot;${type?.toUpperCase()}&quot; Triggered!`,
        },
      });
    const entities: Array&lt;string&gt; = [
      &quot;users&quot;,
      &quot;terminals&quot;,
      &quot;reasons&quot;,
      &quot;reason_groups&quot;,
      &quot;cancellation_reasons&quot;,
      &quot;breeds&quot;,
      &quot;shifts&quot;,
      &quot;invoices&quot;,
      &quot;appointments&quot;,
      &quot;items&quot;,
    ];
    switch (type) {
      case &quot;all&quot;:
        if (environment.type !== &quot;production&quot;)
          return (
            (await configureBooking()) &amp;&amp;
            (await configureAppointmentEstimates()) &amp;&amp;
            (await configureAppointmentOptionDetails()) &amp;&amp;
            (await configureTelehealthStatus()) &amp;&amp;
            (await admin
              .firestore()
              .collection(&quot;tasks_queue&quot;)
              .doc(&quot;configure_app&quot;)
              .set(
                {
                  options: {
                    entities,
                    status: &quot;queued&quot;,
                  },
                  worker: &quot;configure_app&quot;,
                  status: &quot;scheduled&quot;,
                  performAt: new Date(),
                  createdOn: new Date(),
                },
                { merge: true }
              )
              .then(async () =&gt; {
                console.log(&quot;APP CONFIGURATION TASK ADDED TO QUEUE!&quot;);
                console.log(
                  `PLEASE WAIT ~${
                    entities.length * 1.5
                  } MINUTES FOR THE TASK QUEUE TO FINISH PROCESSING...`
                );

                return response.status(200).send();
              })
              .catch((error: any) =&gt; {
                throwError(error);
                return response.status(500).send();
              }))
          );
        else {
          console.log(
            &quot;PRODUCTION ENVIRONMENT DETECTED - SKIPPING APP CONFIGURATION AUTOMATION&quot;
          );

          return response.status(200).send();
        }
      case &quot;telehealth&quot;:
        return (await configureTelehealthStatus())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;breeds&quot;:
        return (await configureBreeds())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;invoices&quot;:
        return (await configureInvoices())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;reasons&quot;:
        return (await configureReasons())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;booking&quot;:
        return (await configureBooking())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;reason_groups&quot;:
        return (await configureReasonGroups())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;appointments&quot;:
        return (await configureAppointments())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;items&quot;:
        return (await configureItems())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;cancellation_reasons&quot;:
        return (await configureCancellationReasons())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;estimates&quot;:
        return (await configureAppointmentEstimates())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;options&quot;:
        return (await configureAppointmentOptionDetails())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;shifts&quot;:
        return (await configureShifts())
          ? response.status(200).send()
          : response.status(500).send();
      case &quot;users&quot;:
        return environment.type !== &quot;production&quot;
          ? (await configureUsers())
            ? response.status(200).send()
            : response.status(500).send()
          : response.status(500).send();
      case &quot;terminals&quot;:
        return environment.type !== &quot;production&quot;
          ? (await configureTerminals())
            ? response.status(200).send()
            : response.status(500).send()
          : response.status(500).send();
      default:
        return response.status(500).send();
    }
  } else return response.status(500).send();
};
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:3,&quot;character&quot;:29,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:3,&quot;character&quot;:42,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:19,&quot;character&quot;:12,&quot;text&quot;:&quot;apiKey&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:19,&quot;character&quot;:20,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:19,&quot;character&quot;:40,&quot;text&quot;:&quot;body&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:22,&quot;character&quot;:6,&quot;text&quot;:&quot;apiKey&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:23,&quot;character&quot;:8,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:23,&quot;character&quot;:20,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:27,&quot;character&quot;:56,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:27,&quot;character&quot;:62,&quot;text&quot;:&quot;toUpperCase&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:42,&quot;character&quot;:12,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:44,&quot;character&quot;:12,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:44,&quot;character&quot;:24,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:50,&quot;character&quot;:19,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:15,&quot;text&quot;:&quot;firestore&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:52,&quot;character&quot;:15,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:53,&quot;character&quot;:15,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:54,&quot;character&quot;:15,&quot;text&quot;:&quot;set&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:67,&quot;character&quot;:15,&quot;text&quot;:&quot;then&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:77,&quot;character&quot;:15,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:77,&quot;character&quot;:22,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:78,&quot;character&quot;:27,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:15,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:27,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:144,&quot;character&quot;:15,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/config/initConfig.ts&quot;,&quot;line&quot;:144,&quot;character&quot;:27,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 02 Mar 2023 15:37:59 GMT</p>
    </body>
  </html>
  