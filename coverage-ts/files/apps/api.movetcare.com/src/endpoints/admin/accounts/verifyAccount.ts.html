
  <!DOCTYPE html>
  <html>
    <head>
      <title>verifyAccount.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts</td><td class="">89.15%</td><td class="">75%</td><td class="">1254</td><td class="">1118</td><td class="">136</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import {
  admin,
  defaultRuntimeOptions,
  environment,
  functions,
  stripe,
  throwError,
} from &quot;../../../config/config&quot;;
import { fetchEntity } from &quot;../../../integrations/provet/entities/fetchEntity&quot;;
import { sendNotification } from &quot;../../../notifications/sendNotification&quot;;
import { getAuthUserById } from &quot;../../../utils/auth/getAuthUserById&quot;;
import { formatPhoneNumber } from &quot;../../../utils/formatPhoneNumber&quot;;
import { verifyValidPaymentSource } from &quot;../../../utils/verifyValidPaymentSource&quot;;
import { requestIsAuthorized } from &quot;../../admin/pos/requestIsAuthorized&quot;;
const DEBUG = false; // environment.type === &quot;production&quot;;
interface AccountData {
  email: string;
  displayName: string;
  sendEmail: boolean;
  sendSms: boolean;
  emailVerified: boolean;
  phoneNumber: string | null;
  city: string;
  street: string;
  state: string;
  zipCode: string;
  alerts: Alerts;
  customer: string | Array&lt;string&gt;;
  paymentMethods: any;
}
interface Alerts {
  errors: Array&lt;string | undefined&gt;;
  warnings: Array&lt;string | undefined&gt;;
}
interface AuthData {
  email: string;
  displayName: string;
  phoneNumber: string;
  uid: string;
  emailVerified: boolean;
}

interface MovetData {
  email: string;
  phone: string;
  sendEmail: boolean;
  sendSms: boolean;
  firstName: string;
  lastName: string;
  city: string;
  street: string;
  state: string;
  zipCode: string;
  customer: string | { id: string | undefined };
}

interface ProvetData {
  email: string;
  phone_numbers: Array&lt;{
    description: &quot;Default Phone Number - Used for SMS Alerts&quot;;
    number: string;
  }&gt;;
  no_email: boolean;
  no_sms: boolean;
  firstname: string;
  lastname: string;
  street_address: string;
  city: string;
  state: string;
  zip_code: string;
}

interface StripeData {
  customer: Array&lt;string&gt;;
}
export const verifyAccount = functions
  .runWith(defaultRuntimeOptions)
  .https.onCall(
    async (
      { id }: { id: string },
      context: any
    ): Promise&lt;AccountData | false&gt; =&gt; {
      if (DEBUG) console.log(&quot;verifyAccount DATA =&gt;&quot;, id);
      if (await requestIsAuthorized(context)) {
        try {
          const { authData, movetData, provetData, stripeData } =
            await getAllAccountData(id);
          if (DEBUG)
            console.log(&quot;accountData&quot;, {
              authData,
              movetData,
              provetData,
              stripeData,
            });
          await fixCustomerDataIfNeeded(id, movetData);
          const alerts: Alerts = {
            errors: [
              ...getEmailErrors({ authData, movetData, provetData }),
              ...getNotificationErrors({ movetData, provetData }),
              ...getNameErrors({ authData, movetData, provetData }),
              ...getPhoneNumberErrors({ authData, movetData, provetData }),
              ...getAddressErrors({ movetData, provetData }),
              ...getCustomerErrors({ stripeData, movetData }),
              ...(await getPaymentMethodErrors({
                stripeData,
                movetData,
              })),
            ],
            warnings: [
              ...getNotificationWarnings(movetData),
              ...getNameWarnings({ authData, movetData, provetData }),
              ...getPhoneNumberWarnings({ authData, movetData, provetData }),
              ...getAddressWarnings({ movetData, provetData }),
              ...getCustomerWarnings({ movetData, stripeData }),
              ...(await getPaymentMethodWarnings({
                id,
                stripeData,
              })),
            ],
          };
          if (
            alerts.errors.length &gt; 0 &amp;&amp;
            !authData?.email?.includes(&quot;+test&quot;) &amp;&amp;
            authData?.email !== null
          ) {
            sendNotification({
              type: &quot;slack&quot;,
              payload: {
                message:
                  `:fire_extinguisher: MoVET Account Errors Found for ${authData?.displayName} (${authData?.email})! Please Fix ASAP!\n\n` +
                  &quot;```&quot; +
                  JSON.stringify(alerts.errors) +
                  &quot;```\n&quot; +
                  (environment.type === &quot;production&quot;
                    ? &quot;https://admin.movetcare.com&quot;
                    : &quot;http://localhost:3002&quot;) +
                  &quot;/client?id=&quot; +
                  id,
              },
            });
            sendNotification({
              type: &quot;email&quot;,
              payload: {
                to: &quot;support@movetcare.com&quot;,
                subject: `MoVET Account Errors Found for ${authData?.displayName} (${authData?.email})! Please Fix ASAP`,
                message:
                  &quot;&lt;p&gt;&quot; +
                  JSON.stringify(alerts.errors) +
                  &quot;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&quot; +
                  (environment.type === &quot;production&quot;
                    ? &quot;https://admin.movetcare.com&quot;
                    : &quot;http://localhost:3002&quot;) +
                  &quot;/client?id=&quot; +
                  id +
                  &quot;&lt;/b&gt;&lt;/p&gt;&quot;,
              },
            });
          } else if (
            alerts.warnings.length &gt; 0 &amp;&amp;
            !authData?.email?.includes(&quot;+test&quot;) &amp;&amp;
            authData?.email !== null
          ) {
            sendNotification({
              type: &quot;slack&quot;,
              payload: {
                message:
                  &quot;:warning: MoVET Account Warnings Found!\n\n&quot; +
                  &quot;```&quot; +
                  JSON.stringify(alerts.warnings) +
                  &quot;```\n&quot; +
                  (environment.type === &quot;production&quot;
                    ? &quot;https://admin.movetcare.com&quot;
                    : &quot;http://localhost:3002&quot;) +
                  &quot;/client?id=&quot; +
                  id,
              },
            });
          }
          return {
            alerts,
            email: authData?.email || &quot;MISSING EMAIL&quot;,
            sendEmail: movetData?.sendEmail || false,
            sendSms: movetData?.sendSms || false,
            emailVerified: authData?.emailVerified || false,
            phoneNumber: authData?.phoneNumber
              ? formatPhoneNumber(authData?.phoneNumber)
              : &quot;MISSING&quot;,
            displayName: authData?.displayName || &quot;MISSING CLIENT NAME&quot;,
            city: movetData?.city || &quot;MISSING CITY - &quot;,
            street: movetData?.street || &quot;MISSING STREET - &quot;,
            state: movetData?.state || &quot;MISSING STATE - &quot;,
            zipCode: movetData?.zipCode || &quot;MISSING ZIPCODE&quot;,
            customer: stripeData?.customer || &quot;MISSING CUSTOMER ID&quot;,
            paymentMethods:
              Array.isArray(stripeData?.customer) &amp;&amp;
              stripeData?.customer.length &gt; 0
                ? await getPaymentMethods(id, stripeData)
                : [],
          };
        } catch (error) {
          console.log(&quot;ERROR: verifyAccount&quot;, error);
          return false;
        }
      } else return false;
    }
  );

const getAllAccountData = async (
  id: string
): Promise&lt;{
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
  stripeData: StripeData;
}&gt; =&gt; {
  return {
    authData: await getAuthUserById(id, [
      &quot;email&quot;,
      &quot;displayName&quot;,
      &quot;phoneNumber&quot;,
      &quot;uid&quot;,
      &quot;emailVerified&quot;,
    ]),
    movetData: await admin
      .firestore()
      .collection(&quot;clients&quot;)
      .doc(id)
      .get()
      .then(async (document: any) =&gt; document.data())
      .catch((error: any) =&gt; throwError(error)),
    provetData: await fetchEntity(&quot;client&quot;, Number(id)),
    stripeData: {
      customer: (
        (await stripe.customers
          .search({
            query: `metadata[&#x27;clientId&#x27;]:&#x27;${id}&#x27;`,
          })
          .catch((error: any) =&gt; throwError(error))) as any
      ).data?.map((customer: { id: string }) =&gt; customer?.id),
    },
  };
};

const fixCustomerDataIfNeeded = async (id: string, movetData: MovetData) =&gt; {
  if (DEBUG) console.log(&quot;movetData?.customer&quot;, movetData?.customer);
  if ((movetData?.customer as any)?.id !== undefined)
    await admin
      .firestore()
      .collection(&quot;clients&quot;)
      .doc(id)
      .set(
        { customer: (movetData?.customer as any)?.id, updatedOn: new Date() },
        { merge: true }
      )
      .then(() =&gt; DEBUG &amp;&amp; console.log(`FIXED CUSTOMER DATA FOR CLIENT ${id}`))
      .catch((error: any) =&gt; throwError(error));
};

const getPaymentMethods = async (id: string, stripeData: any) =&gt; {
  const movetPaymentMethods = await admin
    .firestore()
    .collection(&quot;clients&quot;)
    .doc(id)
    .collection(&quot;payment_methods&quot;)
    .get()
    .then((snapshot: any) =&gt; {
      const paymentMethods: Array&lt;any&gt; = [];
      snapshot.docs.map((doc: any) =&gt; {
        if (doc.data().active) paymentMethods.push(doc.data());
      });
      return paymentMethods;
    })
    .catch((error: any) =&gt; throwError(error));
  if (stripeData?.customer[0] !== undefined) {
    const stripePaymentMethods = await verifyValidPaymentSource(
      id,
      stripeData?.customer[0],
      true
    );
    if (DEBUG) {
      console.log(&quot;movetPaymentMethods&quot;, movetPaymentMethods);
      console.log(&quot;stripePaymentMethods&quot;, stripePaymentMethods);
      console.log(
        &quot;stripePaymentMethods &amp;&amp; movetPaymentMethods.length !== 0&quot;,
        stripePaymentMethods &amp;&amp; movetPaymentMethods.length !== 0
      );
    }
    if (stripePaymentMethods &amp;&amp; movetPaymentMethods.length !== 0)
      return stripePaymentMethods;
    else return [];
  } else return [];
};

const getEmailErrors = ({
  authData,
  movetData,
  provetData,
}: {
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (
    movetData?.email === undefined ||
    movetData?.email === null ||
    provetData?.email === undefined ||
    provetData?.email === null ||
    authData?.email === undefined ||
    authData?.email === null ||
    movetData?.email !== provetData?.email
  ) {
    if (movetData?.email === undefined || movetData?.email === null)
      errors.push(&quot;MoVET Email Not Found&quot;);
    if (provetData?.email === undefined || provetData?.email === null)
      errors.push(&quot;ProVet Email Not Found&quot;);
    if (authData?.email === undefined || authData?.email === null)
      errors.push(&quot;Auth Email Not Found&quot;);
  } else {
    if (movetData?.email !== provetData?.email)
      errors.push(
        `MoVET Email Address (${movetData?.email}) does NOT match ProVet Email Address (${provetData?.email})`
      );
    if (authData?.email !== provetData?.email)
      errors.push(
        `Auth Email Address (${authData?.email}) does NOT match ProVet Email Address (${provetData?.email})`
      );
    if (authData?.email !== movetData?.email)
      errors.push(
        `Auth Email Address (${authData?.email}) does NOT match MoVET Email Address (${movetData?.email})`
      );
  }
  if (DEBUG) console.log(&quot;getEmailErrors&quot;, errors);
  return errors;
};

const getNotificationErrors = ({
  movetData,
  provetData,
}: {
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (
    movetData?.sendEmail === undefined ||
    movetData?.sendSms === undefined ||
    provetData?.no_sms === undefined ||
    provetData?.no_email === undefined
  ) {
    if (movetData?.sendEmail === undefined)
      errors.push(&quot;MoVET Email Notification Setting Not Found&quot;);
    if (movetData?.sendSms === undefined)
      errors.push(&quot;MoVET SMS Notification Setting Not Found&quot;);
    if (provetData?.no_sms === undefined)
      errors.push(&quot;ProVet SMS Notification Setting Not Found&quot;);
    if (provetData?.no_email === undefined)
      errors.push(&quot;ProVet Email Notification Setting Not Found&quot;);
  } else {
    if (movetData?.sendEmail !== !provetData?.no_email)
      errors.push(
        `MoVET Email Notifications (${
          movetData?.sendEmail
        }) does NOT match ProVet Email Notifications (${!provetData?.no_email})`
      );
    if (movetData?.sendSms !== !provetData?.no_sms)
      errors.push(
        `MoVET Email Notifications (${
          movetData?.sendSms
        }) does NOT match ProVet Email Notifications (${!provetData?.no_sms})`
      );
  }
  if (DEBUG) console.log(&quot;getNotificationErrors&quot;, errors);
  return errors;
};

const getNotificationWarnings = (
  movetData: MovetData
): Array&lt;string | undefined&gt; =&gt; {
  const warnings: Array&lt;string | undefined&gt; = [];
  if (movetData?.sendEmail === false)
    warnings.push(&quot;This Client Will NOT Receive Email Notifications&quot;);
  if (movetData?.sendSms === false)
    warnings.push(&quot;This Client Will NOT Receive SMS Notifications&quot;);
  if (DEBUG) console.log(&quot;getNotificationWarnings&quot;, warnings);
  return warnings;
};

const getNameErrors = ({
  authData,
  movetData,
  provetData,
}: {
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (
    movetData?.firstName !== undefined &amp;&amp;
    provetData?.firstname !== undefined &amp;&amp;
    movetData?.firstName !== provetData?.firstname
  )
    errors.push(
      `MoVET First Name (${movetData?.firstName}) does NOT match ProVet First Name (${provetData?.firstname})`
    );
  if (
    movetData?.lastName !== undefined &amp;&amp;
    provetData?.lastname !== undefined &amp;&amp;
    movetData?.lastName !== provetData?.lastname
  )
    errors.push(
      `MoVET Last Name (${movetData?.lastName}) does NOT match ProVet Last Name (${provetData?.lastname})`
    );
  if (
    movetData?.firstName !== undefined &amp;&amp;
    movetData?.lastName !== undefined &amp;&amp;
    authData?.displayName !== null &amp;&amp;
    authData?.displayName !== undefined &amp;&amp;
    authData?.displayName !== `${movetData?.firstName} ${movetData?.lastName}`
  )
    errors.push(
      `Auth Display Name (${
        authData?.displayName
      }) does NOT match MoVET First Name &amp; Last Name (${`${movetData?.firstName} ${movetData?.lastName}`})`
    );
  if (
    provetData?.firstname !== undefined &amp;&amp;
    provetData?.lastname !== undefined &amp;&amp;
    authData?.displayName !== undefined &amp;&amp;
    authData?.displayName !== null &amp;&amp;
    authData?.displayName !== `${provetData?.firstname} ${provetData?.lastname}`
  )
    errors.push(
      `Auth Display Name (${
        authData?.displayName
      }) does NOT match MoVET First Name &amp; Last Name (${`${provetData?.firstname} ${provetData?.lastname}`})`
    );

  if (DEBUG) console.log(&quot;getNameErrors&quot;, errors);
  return errors;
};

const getNameWarnings = ({
  authData,
  movetData,
  provetData,
}: {
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const warnings: Array&lt;string | undefined&gt; = [];

  if (movetData?.firstName === undefined)
    warnings.push(&quot;MoVET First Name Not Found&quot;);
  if (movetData?.lastName === undefined)
    warnings.push(&quot;MoVET Last Name Not Found&quot;);
  if (provetData?.firstname === undefined)
    warnings.push(&quot;ProVet First Name Not Found&quot;);
  if (provetData?.lastname === undefined)
    warnings.push(&quot;ProVet First Name Not Found&quot;);
  if (authData?.displayName === undefined)
    warnings.push(&quot;Auth Display Name Not Found&quot;);
  if (movetData?.firstName === &quot;&quot;) warnings.push(&quot;MoVET First Name is Empty&quot;);
  if (movetData?.lastName === &quot;&quot;) warnings.push(&quot;MoVET Last Name is Empty&quot;);
  if (provetData?.firstname === &quot;&quot;) warnings.push(&quot;ProVet First Name is Empty&quot;);
  if (provetData?.lastname === &quot;&quot;) warnings.push(&quot;ProVet Last Name is Empty&quot;);
  if (authData?.displayName === &quot;&quot;) warnings.push(&quot;Auth Display Name is Empty&quot;);
  if (DEBUG) console.log(&quot;getNameWarnings&quot;, warnings);
  return warnings;
};

const getPhoneNumberErrors = ({
  authData,
  movetData,
  provetData,
}: {
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  const authPhone = formatPhoneNumber(authData?.phoneNumber);
  const movetPhone = formatPhoneNumber(movetData?.phone);
  let provetPhone: string | null = null;
  provetData?.phone_numbers?.map((phone: any) =&gt; {
    if (DEBUG) console.log(&quot;provet phone&quot;, phone);
    if (
      phone.description === &quot;Default Phone Number - Used for SMS Alerts&quot; ||
      (phone.type === &quot;mobile&quot; &amp;&amp;
        phone.is_secondary_owners_phone_number === false)
    ) {
      if (DEBUG) {
        console.log(&quot;phone.description&quot;, phone.description);
        console.log(
          &quot; (phone.type === mobile &amp;&amp;  phone.is_secondary_owners_phone_number === false)&quot;,
          phone.type === &quot;mobile&quot; &amp;&amp;
            phone.is_secondary_owners_phone_number === false
        );
      }
      provetPhone = formatPhoneNumber(phone.number);
    }
  });
  if (DEBUG) {
    console.log(&quot;authPhone&quot;, authPhone);
    console.log(&quot;movetPhone&quot;, movetPhone);
    console.log(&quot;provetPhone&quot;, provetPhone);
  }
  if (movetPhone !== null || provetPhone !== null || authPhone !== null) {
    if (movetPhone !== provetPhone)
      errors.push(
        `MoVET Phone Number (${movetPhone}) does NOT match ProVet Phone Number (${provetPhone})`
      );
    if (movetPhone !== authPhone)
      errors.push(
        `MoVET Phone Number (${movetPhone}) does NOT match Auth Phone Number (${authPhone})`
      );
    if (provetPhone !== authPhone)
      errors.push(
        `MoVET Phone Number (${provetPhone}) does NOT match Auth Phone Number (${authPhone})`
      );
  }
  if (DEBUG) console.log(&quot;getPhoneNumberErrors&quot;, errors);
  return errors;
};

const getPhoneNumberWarnings = ({
  authData,
  movetData,
  provetData,
}: {
  authData: AuthData;
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const warnings: Array&lt;string | undefined&gt; = [];
  const authPhone = formatPhoneNumber(authData?.phoneNumber);
  const movetPhone = formatPhoneNumber(movetData?.phone);
  let provetPhone: string | null = null;
  provetData?.phone_numbers?.map((phone: any) =&gt; {
    if (DEBUG) console.log(&quot;provet phone&quot;, phone);
    if (
      phone.description === &quot;Default Phone Number - Used for SMS Alerts&quot; ||
      (phone.type === &quot;mobile&quot; &amp;&amp;
        phone.is_secondary_owners_phone_number === false)
    ) {
      if (DEBUG) {
        console.log(&quot;phone.description&quot;, phone.description);
        console.log(
          &quot; (phone.type === mobile &amp;&amp;  phone.is_secondary_owners_phone_number === false)&quot;,
          phone.type === &quot;mobile&quot; &amp;&amp;
            phone.is_secondary_owners_phone_number === false
        );
      }
      provetPhone = formatPhoneNumber(phone.number);
    }
  });
  if (DEBUG) {
    console.log(&quot;authPhone&quot;, authPhone);
    console.log(&quot;movetPhone&quot;, movetPhone);
    console.log(&quot;provetPhone&quot;, provetPhone);
  }
  if (movetPhone === null) warnings.push(&quot;MoVET Phone Number Not Found&quot;);
  if (provetPhone === null) warnings.push(&quot;ProVet Phone Number Not Found&quot;);
  if (authPhone === null) warnings.push(&quot;Auth Phone Number Not Found&quot;);
  if (DEBUG) console.log(&quot;getPhoneNumberWarnings&quot;, warnings);
  return warnings;
};

const getAddressErrors = ({
  movetData,
  provetData,
}: {
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (movetData?.street &amp;&amp; movetData?.street !== provetData?.street_address)
    errors.push(
      `MoVET Street Address (${movetData?.street}) does NOT match ProVet Street Address (${provetData?.street_address})`
    );
  if (movetData?.city &amp;&amp; movetData?.city !== provetData?.city)
    errors.push(
      `MoVET City (${movetData?.city}) does NOT match ProVet City (${provetData?.city})`
    );
  if (movetData?.state &amp;&amp; movetData?.state !== provetData?.state)
    errors.push(
      `MoVET State (${movetData?.state}) does NOT match ProVet State (${provetData?.state})`
    );
  if (movetData?.zipCode &amp;&amp; movetData?.zipCode !== provetData?.zip_code)
    errors.push(
      `MoVET Zipcode (${movetData?.zipCode}) does NOT match ProVet Zipcode (${provetData?.zip_code})`
    );

  if (DEBUG) console.log(&quot;getAddressErrors&quot;, errors);
  return errors;
};

const getAddressWarnings = ({
  movetData,
  provetData,
}: {
  movetData: MovetData;
  provetData: ProvetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (movetData?.street === undefined || movetData?.street === &quot;&quot;)
    errors.push(&quot;MoVET Street Address Not Found&quot;);
  if (movetData?.city === undefined || movetData?.city === &quot;&quot;)
    errors.push(&quot;MoVET City Not Found&quot;);
  if (movetData?.state === undefined || movetData?.state === &quot;&quot;)
    errors.push(&quot;MoVET State Not Found&quot;);
  if (movetData?.zipCode === undefined || movetData?.zipCode === &quot;&quot;)
    errors.push(&quot;MoVET Zipcode Not Found&quot;);
  if (
    provetData?.street_address === undefined ||
    provetData?.street_address === &quot;&quot;
  )
    errors.push(&quot;ProVet Street Address Not Found&quot;);
  if (provetData?.city === undefined || provetData?.city === &quot;&quot;)
    errors.push(&quot;ProVet City Not Found&quot;);
  if (provetData?.state === undefined || provetData?.state === &quot;&quot;)
    errors.push(&quot;ProVet State Not Found&quot;);
  if (provetData?.zip_code === undefined || provetData?.zip_code === &quot;&quot;)
    errors.push(&quot;ProVet Zipcode Not Found&quot;);
  if (DEBUG) console.log(&quot;getAddressErrors&quot;, errors);
  return errors;
};

const getCustomerErrors = ({
  stripeData,
  movetData,
}: {
  stripeData: StripeData;
  movetData: MovetData;
}): Array&lt;string | undefined&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (stripeData.customer.length &gt; 1)
    errors.push(
      &quot;Multiple Stripe Customers Found: &quot; + JSON.stringify(stripeData.customer)
    );
  stripeData.customer.map((customer: string) =&gt; {
    if (
      typeof movetData?.customer !== &quot;string&quot; &amp;&amp;
      movetData?.customer?.id !== undefined &amp;&amp;
      movetData?.customer?.id !== customer
    )
      errors.push(
        `MoVET Customer ID (${movetData?.customer?.id}) does NOT match Stripe Customer ID (${customer})`
      );
    else if (movetData?.customer !== customer)
      errors.push(
        `MoVET Customer ID (${JSON.stringify(
          movetData?.customer
        )}) does NOT match Stripe Customer ID (${customer})`
      );
  });
  if (DEBUG) console.log(&quot;getCustomerErrors&quot;, errors);
  return errors;
};
const getPaymentMethodErrors = async ({
  stripeData,
  movetData,
}: {
  stripeData: StripeData;
  movetData: MovetData;
}): Promise&lt;Array&lt;string | undefined&gt;&gt; =&gt; {
  const errors: Array&lt;string | undefined&gt; = [];
  if (Array.isArray(stripeData.customer) &amp;&amp; stripeData.customer.length &gt; 1)
    errors.push(
      &quot;Can NOT determine Payment Methods as multiple Stripe Customers were found: &quot; +
        JSON.stringify(stripeData.customer)
    );
  else {
    if (Array.isArray(stripeData.customer))
      stripeData.customer.map((customer: string) =&gt; {
        if (
          typeof movetData?.customer !== &quot;string&quot; &amp;&amp;
          movetData?.customer?.id !== undefined &amp;&amp;
          movetData?.customer?.id !== customer
        )
          errors.push(
            `Can NOT determine Payment Methods as MoVET Customer ID (${movetData?.customer?.id}) does NOT match Stripe Customer ID (${customer})`
          );
        else if (movetData?.customer !== customer)
          errors.push(
            `Can NOT determine Payment Methods as MoVET Customer ID (${JSON.stringify(
              movetData?.customer
            )}) does NOT match Stripe Customer ID (${customer})`
          );
      });
  }
  if (DEBUG) console.log(&quot;getPaymentMethodErrors&quot;, errors);
  return errors;
};

const getCustomerWarnings = ({
  movetData,
  stripeData,
}: {
  stripeData: StripeData;
  movetData: MovetData;
}) =&gt; {
  const warnings: Array&lt;string | undefined&gt; = [];
  if (movetData?.customer === undefined &amp;&amp; stripeData.customer.length === 0)
    warnings.push(&quot;No Customer ID Found&quot;);
  else {
    if (movetData?.customer === undefined)
      warnings.push(&quot;No MoVET Customer ID Found&quot;);
    if (stripeData.customer.length === 0)
      warnings.push(&quot;No Stripe Customer ID Found&quot;);
  }
  if (DEBUG) console.log(&quot;getCustomerWarnings&quot;, warnings);
  return warnings;
};

const getPaymentMethodWarnings = async ({
  id,
  stripeData,
}: {
  id: string;
  stripeData: StripeData;
}): Promise&lt;Array&lt;string | undefined&gt;&gt; =&gt; {
  const warnings: Array&lt;string | undefined&gt; = [];
  const movetPaymentMethods = await admin
    .firestore()
    .collection(&quot;clients&quot;)
    .doc(id)
    .collection(&quot;payment_methods&quot;)
    .get()
    .then((snapshot: any) =&gt; {
      const paymentMethods: Array&lt;any&gt; = [];
      snapshot.docs.map((doc: any) =&gt; {
        if (doc.data().active) paymentMethods.push(doc.data());
      });
      return paymentMethods;
    })
    .catch((error: any) =&gt; throwError(error));
  if (DEBUG) console.log(&quot;movetPaymentMethods&quot;, movetPaymentMethods);
  if (stripeData?.customer[0] !== undefined) {
    const stripePaymentMethods = await verifyValidPaymentSource(
      id,
      stripeData.customer[0],
      true
    );
    if (DEBUG) console.log(&quot;stripePaymentMethods&quot;, stripePaymentMethods);
    if (movetPaymentMethods.length === 0 &amp;&amp; !stripePaymentMethods)
      warnings.push(
        &quot;Customer does NOT have a VALID Payment Method on their MoVET account or in Stripe&quot;
      );
    else if (!stripePaymentMethods)
      warnings.push(&quot;Customer does NOT have a VALID Payment Method in Stripe&quot;);
    else if (movetPaymentMethods.length === 0)
      warnings.push(
        &quot;Customer does NOT have a VALID Payment Method on MoVET Account&quot;
      );
  }
  if (DEBUG) console.log(&quot;getPaymentMethodWarnings&quot;, warnings);
  return warnings;
};
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:1,&quot;character&quot;:2,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:3,&quot;character&quot;:2,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:4,&quot;character&quot;:2,&quot;text&quot;:&quot;functions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:28,&quot;character&quot;:2,&quot;text&quot;:&quot;paymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:75,&quot;character&quot;:13,&quot;text&quot;:&quot;verifyAccount&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:75,&quot;character&quot;:29,&quot;text&quot;:&quot;functions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:76,&quot;character&quot;:3,&quot;text&quot;:&quot;runWith&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:77,&quot;character&quot;:3,&quot;text&quot;:&quot;https&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:77,&quot;character&quot;:9,&quot;text&quot;:&quot;onCall&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:80,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:83,&quot;character&quot;:36,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:133,&quot;character&quot;:19,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:133,&quot;character&quot;:31,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:149,&quot;character&quot;:19,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:149,&quot;character&quot;:31,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:170,&quot;character&quot;:19,&quot;text&quot;:&quot;environment&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:170,&quot;character&quot;:31,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:200,&quot;character&quot;:46,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:199,&quot;character&quot;:17,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:223,&quot;character&quot;:21,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:224,&quot;character&quot;:7,&quot;text&quot;:&quot;firestore&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:225,&quot;character&quot;:7,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:226,&quot;character&quot;:7,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:227,&quot;character&quot;:7,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:228,&quot;character&quot;:7,&quot;text&quot;:&quot;then&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:228,&quot;character&quot;:19,&quot;text&quot;:&quot;document&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:228,&quot;character&quot;:37,&quot;text&quot;:&quot;document&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:228,&quot;character&quot;:46,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:229,&quot;character&quot;:7,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:229,&quot;character&quot;:14,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:229,&quot;character&quot;:40,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:237,&quot;character&quot;:18,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:237,&quot;character&quot;:44,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:238,&quot;character&quot;:8,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:238,&quot;character&quot;:14,&quot;text&quot;:&quot;map&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:245,&quot;character&quot;:36,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:246,&quot;character&quot;:10,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:247,&quot;character&quot;:7,&quot;text&quot;:&quot;firestore&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:248,&quot;character&quot;:7,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:249,&quot;character&quot;:7,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:250,&quot;character&quot;:7,&quot;text&quot;:&quot;set&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:251,&quot;character&quot;:10,&quot;text&quot;:&quot;customer&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:251,&quot;character&quot;:50,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:254,&quot;character&quot;:7,&quot;text&quot;:&quot;then&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:255,&quot;character&quot;:7,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:255,&quot;character&quot;:14,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:255,&quot;character&quot;:40,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:258,&quot;character&quot;:45,&quot;text&quot;:&quot;stripeData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:259,&quot;character&quot;:8,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:259,&quot;character&quot;:36,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:260,&quot;character&quot;:5,&quot;text&quot;:&quot;firestore&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:261,&quot;character&quot;:5,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:262,&quot;character&quot;:5,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:263,&quot;character&quot;:5,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:264,&quot;character&quot;:5,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:265,&quot;character&quot;:5,&quot;text&quot;:&quot;then&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:265,&quot;character&quot;:11,&quot;text&quot;:&quot;snapshot&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:267,&quot;character&quot;:6,&quot;text&quot;:&quot;snapshot&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:267,&quot;character&quot;:15,&quot;text&quot;:&quot;docs&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:267,&quot;character&quot;:20,&quot;text&quot;:&quot;map&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:267,&quot;character&quot;:25,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:268,&quot;character&quot;:12,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:268,&quot;character&quot;:16,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:268,&quot;character&quot;:23,&quot;text&quot;:&quot;active&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:268,&quot;character&quot;:51,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:268,&quot;character&quot;:55,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:272,&quot;character&quot;:5,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:272,&quot;character&quot;:12,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:272,&quot;character&quot;:38,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:273,&quot;character&quot;:6,&quot;text&quot;:&quot;stripeData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:273,&quot;character&quot;:18,&quot;text&quot;:&quot;customer&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:6,&quot;text&quot;:&quot;stripeData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:276,&quot;character&quot;:18,&quot;text&quot;:&quot;customer&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:280,&quot;character&quot;:41,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:284,&quot;character&quot;:32,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:284,&quot;character&quot;:52,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:287,&quot;character&quot;:32,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:287,&quot;character&quot;:52,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:486,&quot;character&quot;:34,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:487,&quot;character&quot;:43,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:489,&quot;character&quot;:6,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:489,&quot;character&quot;:12,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:7,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:13,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:8,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:14,&quot;text&quot;:&quot;is_secondary_owners_phone_number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:494,&quot;character&quot;:41,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:494,&quot;character&quot;:47,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:497,&quot;character&quot;:10,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:497,&quot;character&quot;:16,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:498,&quot;character&quot;:12,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:498,&quot;character&quot;:18,&quot;text&quot;:&quot;is_secondary_owners_phone_number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:501,&quot;character&quot;:38,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:501,&quot;character&quot;:44,&quot;text&quot;:&quot;number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:540,&quot;character&quot;:34,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:541,&quot;character&quot;:43,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:543,&quot;character&quot;:6,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:543,&quot;character&quot;:12,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:544,&quot;character&quot;:7,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:544,&quot;character&quot;:13,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:545,&quot;character&quot;:8,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:545,&quot;character&quot;:14,&quot;text&quot;:&quot;is_secondary_owners_phone_number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:548,&quot;character&quot;:41,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:548,&quot;character&quot;:47,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:551,&quot;character&quot;:10,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:551,&quot;character&quot;:16,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:552,&quot;character&quot;:12,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:552,&quot;character&quot;:18,&quot;text&quot;:&quot;is_secondary_owners_phone_number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:555,&quot;character&quot;:38,&quot;text&quot;:&quot;phone&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:555,&quot;character&quot;:44,&quot;text&quot;:&quot;number&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:725,&quot;character&quot;:8,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:725,&quot;character&quot;:36,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:726,&quot;character&quot;:5,&quot;text&quot;:&quot;firestore&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:727,&quot;character&quot;:5,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:728,&quot;character&quot;:5,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:729,&quot;character&quot;:5,&quot;text&quot;:&quot;collection&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:730,&quot;character&quot;:5,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:731,&quot;character&quot;:5,&quot;text&quot;:&quot;then&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:731,&quot;character&quot;:11,&quot;text&quot;:&quot;snapshot&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:733,&quot;character&quot;:6,&quot;text&quot;:&quot;snapshot&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:733,&quot;character&quot;:15,&quot;text&quot;:&quot;docs&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:733,&quot;character&quot;:20,&quot;text&quot;:&quot;map&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:733,&quot;character&quot;:25,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:734,&quot;character&quot;:12,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:734,&quot;character&quot;:16,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:734,&quot;character&quot;:23,&quot;text&quot;:&quot;active&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:734,&quot;character&quot;:51,&quot;text&quot;:&quot;doc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:734,&quot;character&quot;:55,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:738,&quot;character&quot;:5,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:738,&quot;character&quot;:12,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:738,&quot;character&quot;:38,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:739,&quot;character&quot;:48,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:747,&quot;character&quot;:8,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:747,&quot;character&quot;:28,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:753,&quot;character&quot;:13,&quot;text&quot;:&quot;movetPaymentMethods&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/admin/accounts/verifyAccount.ts&quot;,&quot;line&quot;:753,&quot;character&quot;:33,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 02 Mar 2023 15:37:59 GMT</p>
    </body>
  </html>
  