
  <!DOCTYPE html>
  <html>
    <head>
      <title>incomingWebhook.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts</td><td class="">65.22%</td><td class="">75%</td><td class="">115</td><td class="">75</td><td class="">40</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">const express = require(&quot;express&quot;);
const cors = require(&quot;cors&quot;);
import { Request, Response, NextFunction } from &quot;express&quot;;
import {
  admin,
  defaultRuntimeOptions,
  functions,
  DEBUG,
} from &quot;../../config/config&quot;;

import { processProVetWebhook } from &quot;../../integrations/provet/processWebhook&quot;;
import { initProVetConfig } from &quot;../../config/initConfig&quot;;
import { processExpoWebhook } from &quot;../../integrations/expo/processWebhook&quot;;
import { processStripeWebhook } from &quot;../../integrations/stripe/processWebhook&quot;;

const decodeJWT = async (
  req: Request,
  res: Response,
  next: NextFunction
): Promise&lt;any&gt; =&gt; {
  if (req.headers?.authorization?.startsWith(&quot;Bearer &quot;)) {
    const idToken = req.headers.authorization.split(&quot;Bearer &quot;)[1];
    if (DEBUG) {
      console.log(&quot;idToken&quot;, idToken);
      console.log(&quot;req&quot;, req);
      console.log(&quot;res&quot;, res);
    }

    try {
      const decodedToken = await admin.auth.verifyIdToken(idToken);
      // @ts-ignore
      req[&quot;currentUser&quot;] = decodedToken;
    } catch (error: any) {
      console.error(error);
    }
  }

  next();
};

const runAsync =
  (callback: Function) =&gt;
  (req: Request, res: Response, next: NextFunction): Promise&lt;any&gt; =&gt;
    callback(req, res, next).catch(next);

const app = express();

app.use(cors({ origin: true }));

app.use(
  express.json({
    verify: (req: any, res: any, buffer: any) =&gt; (req[&quot;rawBody&quot;] = buffer),
  })
);

app.use(decodeJWT);

app.post(&quot;/app/config/&quot;, runAsync(initProVetConfig));
app.post(&quot;/provet/webhook/&quot;, runAsync(processProVetWebhook));
app.post(&quot;/expo/webhook/&quot;, runAsync(processExpoWebhook));
app.post(&quot;/stripe/webhook/&quot;, runAsync(processStripeWebhook));

export const incomingWebhook: Promise&lt;Response&gt; = functions
  .runWith({
    ...defaultRuntimeOptions,
    memory: &quot;2GB&quot;,
  })
  .https.onRequest(app);
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:0,&quot;character&quot;:6,&quot;text&quot;:&quot;express&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:1,&quot;character&quot;:6,&quot;text&quot;:&quot;cors&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:4,&quot;character&quot;:2,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:6,&quot;character&quot;:2,&quot;text&quot;:&quot;functions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:29,&quot;character&quot;:12,&quot;text&quot;:&quot;decodedToken&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:29,&quot;character&quot;:33,&quot;text&quot;:&quot;admin&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:29,&quot;character&quot;:39,&quot;text&quot;:&quot;auth&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:29,&quot;character&quot;:44,&quot;text&quot;:&quot;verifyIdToken&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:33,&quot;character&quot;:20,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:32,&quot;character&quot;:13,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:43,&quot;character&quot;:29,&quot;text&quot;:&quot;catch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:45,&quot;character&quot;:6,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:45,&quot;character&quot;:12,&quot;text&quot;:&quot;express&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:47,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:47,&quot;character&quot;:4,&quot;text&quot;:&quot;use&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:47,&quot;character&quot;:8,&quot;text&quot;:&quot;cors&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:49,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:49,&quot;character&quot;:4,&quot;text&quot;:&quot;use&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:50,&quot;character&quot;:2,&quot;text&quot;:&quot;express&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:50,&quot;character&quot;:10,&quot;text&quot;:&quot;json&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:13,&quot;text&quot;:&quot;req&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:23,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:33,&quot;text&quot;:&quot;buffer&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:50,&quot;text&quot;:&quot;req&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:67,&quot;text&quot;:&quot;buffer&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:55,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:55,&quot;character&quot;:4,&quot;text&quot;:&quot;use&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:57,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:57,&quot;character&quot;:4,&quot;text&quot;:&quot;post&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:58,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:58,&quot;character&quot;:4,&quot;text&quot;:&quot;post&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:59,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:59,&quot;character&quot;:4,&quot;text&quot;:&quot;post&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:60,&quot;character&quot;:0,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:60,&quot;character&quot;:4,&quot;text&quot;:&quot;post&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:62,&quot;character&quot;:50,&quot;text&quot;:&quot;functions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:63,&quot;character&quot;:3,&quot;text&quot;:&quot;runWith&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:67,&quot;character&quot;:3,&quot;text&quot;:&quot;https&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:67,&quot;character&quot;:9,&quot;text&quot;:&quot;onRequest&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;apps/api.movetcare.com/src/endpoints/webhooks/incomingWebhook.ts&quot;,&quot;line&quot;:67,&quot;character&quot;:19,&quot;text&quot;:&quot;app&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 02 Mar 2023 15:37:59 GMT</p>
    </body>
  </html>
  